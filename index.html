<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Baterias 1 – Delivery de Baterias</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="assets/css/enhancements.css" />
    <style>
      .btn-painel {
        position: fixed;
        left: 16px;
        bottom: 16px;
        background: #6a1b9a;
        color: #fff;
        border: none;
        border-radius: 10px;
        padding: 12px 16px;
        box-shadow: 0 6px 18px rgba(0,0,0,.15);
        font-weight: 700;
        letter-spacing: .2px;
        cursor: pointer;
        z-index: 9999;
      }
      .btn-painel:hover { filter: brightness(1.05); }

      /* botão de localização apenas ícone */
      .btn-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        padding: 0;
        border-radius: 6px;
      }
      .btn-icon svg {
        width: 18px;
        height: 18px;
        display: block;
        fill: #fff;
        background: transparent !important;
      }

      .select-btn-wrapper {
        display: flex;
        justify-content: center;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="container header-content">
        <div class="logo">
          <img src="assets/img/logo-baterias1.svg" alt="Baterias 1" />
          <span>Baterias 1</span>
        </div>
        <nav class="nav">
          <a href="#como-funciona">Como funciona</a>
          <a href="#vantagens">Vantagens</a>
          <a href="#contato">Contato</a>
        </nav>
        <button class="btn btn-primary" id="openSelection" aria-label="Peça agora">Peça agora</button>
      </div>
    </header>

    <!-- Hero -->
    <section class="hero">
      <div class="container hero-grid">
        <div class="hero-copy">
          <h1>A bateria certa entregue e instalada onde você estiver</h1>
          <p>Descubra a bateria ideal para seu carro e receba com instalação rápida na sua cidade.</p>
          <button class="btn btn-primary" id="stepsOrder" aria-label="Peça agora">Peça agora</button>
        </div>
        <div class="hero-art">
          <img src="assets/img/hero-battery.svg" alt="Bateria automotiva" />
        </div>
      </div>
    </section>

    <!-- Modal -->
    <div id="selectionModal" class="modal hidden">
      <div class="modal-content">
        <button class="modal-close" id="closeSelection" aria-label="Fechar seleção">×</button>
        <h3>Informe sua cidade</h3>
        <div class="field-group city-group">
          <input
            type="text"
            id="cityInput"
            placeholder="Buscar cidades"
            list="cityList"
          />
          <datalist id="cityList"></datalist>

          <!-- Botão Localização com SVG inline -->
          <button type="button" class="btn btn-primary btn-icon" id="useLocation" title="Usar minha localização">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 21s-6-5.33-6-10a6 6 0 1 1 12 0c0 4.67-6 10-6 10z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
              <circle cx="12" cy="11" r="2.5" fill="currentColor"/>
            </svg>
          </button>
        </div>

        <h3>Informe seu veículo</h3>
        <div class="field-group">
          <input
            type="text"
            id="vehicleInput"
            placeholder="Marca, modelo, ano e versão"
            list="vehicleList"
            autocomplete="off"
          />
          <datalist id="vehicleList"></datalist>
        </div>

        <div class="select-btn-wrapper">
          <button class="btn btn-primary" id="selectVehicle" aria-label="Selecionar veículo" style="margin:14px auto 0;">
            Selecionar
          </button>
        </div>
      </div>
    </div>

    <!-- Resultados -->
    <section id="resultSection" class="hidden">
      <div class="container">
        <div class="battery-card" data-brand="moura">
          <div class="battery-info">
            <h2 id="batteryModel">Moura M60SD</h2>
            <p id="batterySpecs">60Ah • 12V • 540 CCA</p>
            <ul class="battery-details">
              <li>Garantia: <strong id="batteryWarranty">18 meses</strong></li>
              <li>Dimensões: <strong id="batteryDims">242 x 175 x 190 mm</strong></li>
              <li>Peso: <strong id="batteryWeight">15,2 kg</strong></li>
            </ul>
          </div>
          <div class="battery-price">
            <div class="price-line"><span>À vista</span><strong id="priceCash">R$ 499,00</strong></div>
            <div class="price-line"><span>Em 10x</span><strong id="priceInstallments">R$ 55,90</strong></div>
          </div>
        </div>

        <!-- Formulário pedido -->
        <form id="orderForm" class="order-form">
          <div class="actions">
            <button type="submit" class="btn btn-primary" id="submitOrder">Solicitar entrega</button>
          </div>
        </form>
      </div>
    </section>

    <!-- Como funciona -->
    <section id="como-funciona" class="how-it-works">
      <div class="container">
        <h2>Como funciona</h2>
        <div class="steps">
          <div class="step"><span class="num">1</span><h3>Busque sua cidade e veículo</h3><p>Informe onde você está...</p></div>
          <div class="step"><span class="num">2</span><h3>Veja o preço e a garantia</h3><p>Transparência total...</p></div>
          <div class="step"><span class="num">3</span><h3>Receba com instalação</h3><p>Motoboy ou técnico vai até você...</p></div>
        </div>
      </div>
    </section>

    <!-- Vantagens -->
    <section id="vantagens" class="benefits">
      <div class="container">
        <h2>Por que escolher a Baterias 1</h2>
        <ul class="benefits-list">
          <li>Atendimento rápido em Campina Grande e João Pessoa</li>
          <li>Parceria com as melhores marcas</li>
          <li>Instalação e teste inclusos</li>
          <li>Garantia com nota fiscal</li>
        </ul>
      </div>
    </section>

    <!-- Rodapé -->
    <footer id="contato" class="footer">
      <div class="container footer-grid">
        <div><h3>Baterias 1</h3><p>Delivery de baterias com instalação no local.</p></div>
        <div><h4>Contato</h4><p>WhatsApp: (83) 9 9999-9999</p><p>Campina Grande • João Pessoa</p></div>
        <div><h4>Atendimento</h4><p>Seg a Sáb, 8h às 20h</p></div>
      </div>
      <div class="container footer-bottom"><small>© 2025 Baterias 1. Todos os direitos reservados.</small></div>
    </footer>

    <!-- Scripts -->
    <script src="assets/js/app.js"></script>
    <script src="assets/js/autocomplete-motor-versao.js"></script>
    <script src="assets/js/enhancements.js"></script>

    <!-- Bloco de melhorias (7 tópicos) -->
    <script>
      (function(){
        function ready(fn){ document.readyState!=="loading" ? fn() : document.addEventListener("DOMContentLoaded",fn); }
        ready(function(){
          const header=document.querySelector(".header");
          function focusAndScroll(el){
            if(!el) return;
            try{ el.focus({preventScroll:true}); }catch{}
            const hdrH=header?header.getBoundingClientRect().height:0;
            const y=el.getBoundingClientRect().top+window.scrollY-Math.max(hdrH+12,12);
            window.scrollTo({top:y,behavior:"smooth"});
          }
          function resetGeral(){
            ["cityInput","vehicleInput","vehicleResume","plate","customerName","customerPhone","address","city","scheduleDate","scheduleTime"]
              .forEach(id=>{const el=document.getElementById(id);if(el)el.value="";});
            document.querySelectorAll('input[type="radio"]').forEach(r=>r.checked=false);
            document.getElementById("resultSection")?.classList.add("hidden");
            document.querySelectorAll(".battery-card.selected").forEach(c=>c.classList.remove("selected"));
            document.getElementById("scheduleFields")?.classList.add("hidden");
            document.getElementById("installmentsField")?.classList.add("hidden");
            focusAndScroll(document.getElementById("openSelection")||document.getElementById("stepsOrder")||document.body);
          }
          if(header){header.style.position="sticky";header.style.top="0";header.style.zIndex="1000";}
          resetGeral();
          document.querySelector(".logo")?.addEventListener("click",e=>{e.preventDefault();resetGeral();window.scrollTo({top:0,behavior:"smooth"});});
          document.getElementById("openSelection")?.addEventListener("click",resetGeral);

          const selectionModal=document.getElementById("selectionModal");
          const closeSelection=document.getElementById("closeSelection");
          const cityInput=document.getElementById("cityInput");
          const vehicleInput=document.getElementById("vehicleInput");
          const selectVehicleBtn=document.getElementById("selectVehicle");
          function openModal(){selectionModal?.classList.remove("hidden");}
          function closeModal(){selectionModal?.classList.add("hidden");}
          document.getElementById("stepsOrder")?.addEventListener("click",openModal);
          document.getElementById("openSelection")?.addEventListener("click",openModal);
          closeSelection?.addEventListener("click",closeModal);
          cityInput?.addEventListener("change",()=>{if(cityInput.value.trim())focusAndScroll(vehicleInput);});
          selectVehicleBtn?.addEventListener("click",()=>{
            if(!vehicleInput?.value.trim()){vehicleInput?.focus();return;}
            document.getElementById("resultSection")?.classList.remove("hidden");
            closeModal();focusAndScroll(document.querySelector(".battery-card")||document.getElementById("resultSection"));
          });

          function prepararSelecaoCards(){
            const cards=[...document.querySelectorAll(".battery-card")];
            cards.forEach(card=>{
              const hit=card.querySelector(".select-hit")||card;
              hit.style.cursor="pointer";
              hit.addEventListener("click",()=>{
                cards.forEach(c=>c.classList.remove("selected"));
                card.classList.add("selected");
                const imm=document.querySelector('input[name="deliveryTime"][value="40min"]')||document.querySelector('input[name="deliveryTime"]');
                if(imm) imm.checked=true;
                document.getElementById("scheduleFields")?.classList.add("hidden");
                focusAndScroll(imm);
              });
            });
          }
          const rs=document.getElementById("resultSection");
          if(rs&&rs.classList.contains("hidden")){
            const obs=new MutationObserver(()=>{if(!rs.classList.contains("hidden")){prepararSelecaoCards();obs.disconnect();}});
            obs.observe(rs,{attributes:true});
          } else prepararSelecaoCards();

          const fmtBRL=v=>Number(v||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
          const installmentsField=document.getElementById("installmentsField");
          const installmentDynamicLine=document.getElementById("installmentDynamicLine");
          const installmentsSel=document.getElementById("installments");
          function atualizarParcelas(){
            const selCard=document.querySelector(".battery-card.selected");
            let precoTxt=selCard?.querySelector(".battery-price .price-line strong")?.textContent||document.getElementById("priceCash")?.textContent||"0";
            let preco=parseFloat(precoTxt.replace(/[^\d,.-]/g,'').replace('.','').replace(',','.'))||0;
            const n=parseInt(installmentsSel?.value||"10",10);
            const parcela=Math.floor((preco/n)*100)/100;
            const resto=+(preco-parcela*(n-1)).toFixed(2);
            if(installmentDynamicLine)installmentDynamicLine.textContent=`${n}x de ${fmtBRL(parcela)} (última ${fmtBRL(resto)})`;
          }
          document.querySelectorAll('input[name="payment"]').forEach(radio=>{
            radio.addEventListener("change",()=>{
              const credito=radio.checked&&radio.value==="credito";
              installmentsField?.classList.toggle("hidden",!credito);
              if(credito){atualizarParcelas();focusAndScroll(installmentsSel);}
              else{focusAndScroll(document.getElementById("submitOrder"));}
            });
          });
          installmentsSel?.addEventListener("change",()=>{atualizarParcelas();focusAndScroll(document.getElementById("submitOrder"));});

          document.getElementById("customerName")?.addEventListener("change",()=>focusAndScroll(document.getElementById("customerPhone")));
          document.getElementById("customerPhone")?.addEventListener("change",()=>focusAndScroll(document.getElementById("address")));
          document.getElementById("address")?.addEventListener("change",()=>focusAndScroll(document.getElementById("city")));
          document.getElementById("city")?.addEventListener("change",()=>focusAndScroll(document.querySelector('input[name="payment"]')));

          const scheduleFields=document.getElementById("scheduleFields");
          document.querySelectorAll('input[name="deliveryTime"]').forEach(radio=>{
            radio.addEventListener("change",()=>{
              if(radio.checked&&radio.value==="agendar"){
                scheduleFields?.classList.remove("hidden");
                const dia=document.getElementById("scheduleDate");
                focusAndScroll(dia);
                dia?.addEventListener("change",()=>focusAndScroll(document.getElementById("scheduleTime")),{once:true});
              } else if(radio.checked){
                scheduleFields?.classList.add("hidden");
                focusAndScroll(document.getElementById("customerName"));
              }
            });
          });

          document.getElementById("orderForm")?.addEventListener("submit",e=>{
            e.preventDefault();
            const nome=document.getElementById("customerName")?.value||"";
            const fone=document.getElementById("customerPhone")?.value||"";
            const end=document.getElementById("address")?.value||"";
            const cid=document.getElementById("city")?.value||"";
            const veic=document.getElementById("vehicleResume")?.value||document.getElementById("vehicleInput")?.value||"";
            const entrega=(document.querySelector('input[name="deliveryTime"]:checked')?.value||"").toUpperCase();
            const pagamento=(document.querySelector('input[name="payment"]:checked')?.value||"").toUpperCase();
            const selCard=document.querySelector(".battery-card.selected");
            const marca=selCard?.dataset.brand||document.getElementById("batteryModel")?.textContent||"";
            const preco=selCard?.dataset.price||document.getElementById("priceCash")?.textContent||"";
            const msg=`Pedido Baterias 1\nNome: ${nome}\nWhatsApp: ${fone}\nEndereço: ${end} - ${cid}\nVeículo: ${veic}\nBateria: ${marca} - ${preco}\nEntrega: ${entrega}\nPagamento: ${pagamento}`;
            const numero="5511970901461";
            const url="https://wa.me/"+numero+"?text="+encodeURIComponent(msg);
            window.open(url,"_blank");focusAndScroll(document.getElementById("orderForm"));
          });

          ["customerName","customerPhone","address","city","vehicleInput","vehicleResume","plate"].forEach(id=>{
            const el=document.getElementById(id);if(el)el.setAttribute("autocomplete","off");
          });
        });
      })();
    </script>

    <!-- Links fixos -->
    <a href="https://wa.me/5511970901461" class="whatsapp-link" target="_blank" rel="noopener" aria-label="Contato via WhatsApp">
      <img src="whatsapp.svg" alt="WhatsApp" />
    </a>
    <a class="btn-painel" href="./login.html" aria-label="Abrir painel (login)">Painel</a>
  </body>
</html>
